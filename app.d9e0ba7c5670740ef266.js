(()=>{"use strict";(()=>{function e(){}function t(e){return e()}function s(){return Object.create(null)}function n(e){e.forEach(t)}function i(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let a;function r(e,t){return a||(a=document.createElement("a")),a.href=t,e===a.href}function l(e){return 0===Object.keys(e).length}function c(e,t,s,n){return e[1]&&n?function(e,t){for(const s in t)e[s]=t[s];return e}(s.ctx.slice(),e[1](n(t))):s.ctx}new Set;let u,d=!1;function p(e,t){e.appendChild(t)}function h(e,t,s){e.insertBefore(t,s||null)}function f(e){e.parentNode.removeChild(e)}function m(e){return document.createElement(e)}function g(e){return document.createTextNode(e)}function $(){return g(" ")}function y(){return g("")}function b(e,t,s,n){return e.addEventListener(t,s,n),()=>e.removeEventListener(t,s,n)}function v(e,t,s){null==s?e.removeAttribute(t):e.getAttribute(t)!==s&&e.setAttribute(t,s)}function k(e){u=e}function _(e,t){const s=e.$$.callbacks[t.type];s&&s.slice().forEach((e=>e.call(this,t)))}new Set;const M=[],w=[],C=[],A=[],x=Promise.resolve();let T=!1;function U(e){C.push(e)}let E=!1;const N=new Set;function R(){if(!E){E=!0;do{for(let e=0;e<M.length;e+=1){const t=M[e];k(t),S(t.$$)}for(k(null),M.length=0;w.length;)w.pop()();for(let e=0;e<C.length;e+=1){const t=C[e];N.has(t)||(N.add(t),t())}C.length=0}while(M.length);for(;A.length;)A.pop()();T=!1,E=!1,N.clear()}}function S(e){if(null!==e.fragment){e.update(),n(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(U)}}const H=new Set;let I,P;function j(){I={r:0,c:[],p:I}}function z(){I.r||n(I.c),I=I.p}function K(e,t){e&&e.i&&(H.delete(e),e.i(t))}function L(e,t,s,n){if(e&&e.o){if(H.has(e))return;H.add(e),I.c.push((()=>{H.delete(e),n&&(s&&e.d(1),n())})),e.o(t)}}function O(e){e&&e.c()}function q(e,s,o,a){const{fragment:r,on_mount:l,on_destroy:c,after_update:u}=e.$$;r&&r.m(s,o),a||U((()=>{const s=l.map(t).filter(i);c?c.push(...s):n(s),e.$$.on_mount=[]})),u.forEach(U)}function B(e,t){const s=e.$$;null!==s.fragment&&(n(s.on_destroy),s.fragment&&s.fragment.d(t),s.on_destroy=s.fragment=null,s.ctx=[])}function J(t,i,o,a,r,l,c,p=[-1]){const h=u;k(t);const m=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:r,bound:s(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(h?h.$$.context:[])),callbacks:s(),dirty:p,skip_bound:!1,root:i.target||h.$$.root};c&&c(m.root);let g=!1;if(m.ctx=o?o(t,i.props||{},((e,s,...n)=>{const i=n.length?n[0]:s;return m.ctx&&r(m.ctx[e],m.ctx[e]=i)&&(!m.skip_bound&&m.bound[e]&&m.bound[e](i),g&&function(e,t){-1===e.$$.dirty[0]&&(M.push(e),T||(T=!0,x.then(R)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),s})):[],m.update(),g=!0,n(m.before_update),m.fragment=!!a&&a(m.ctx),i.target){if(i.hydrate){d=!0;const e=($=i.target,Array.from($.childNodes));m.fragment&&m.fragment.l(e),e.forEach(f)}else m.fragment&&m.fragment.c();i.intro&&K(t.$$.fragment),q(t,i.target,i.anchor,i.customElement),d=!1,R()}var $;k(h)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(P=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(t).filter(i);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,s){this[e]=s}disconnectedCallback(){n(this.$$.on_disconnect)}$destroy(){B(this,1),this.$destroy=e}$on(e,t){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}$set(e){this.$$set&&!l(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class F{$destroy(){B(this,1),this.$destroy=e}$on(e,t){const s=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return s.push(t),()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}$set(e){this.$$set&&!l(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class W{constructor(e){this.kosyClient=window.parent,this.latestMessageNumber=0,this.kosyApp=e}dictionaryToArray(e){let t=[];for(const s in e)e.hasOwnProperty(s)&&t.push([s,e[s]]);return t}startApp(){return this.initialInfoPromise=new Promise(((e,t)=>{window.addEventListener("message",(t=>{let s=t.data;switch(s.type){case"receive-initial-info":this.latestMessageNumber=s.latestMessageNumber,this.clients=s.payload.clients,this.hostClientUuid=s.payload.initializerClientUuid,this.log("Resolving initial info promise with: ",s.payload),e(s.payload);break;case"set-client-info":{let e=s.clients,t=s.hostClientUuid;this.initialInfoPromise.then((s=>{let n=this.dictionaryToArray(e).filter((e=>!this.clients[e[0]])),i=this.dictionaryToArray(this.clients).filter((t=>!e[t[0]])),o=this.latestMessageNumber;this.hostClientUuid!==t&&this._relayMessageToClients(s,{type:"_host-has-changed",clientUuid:t},++o),n.forEach((e=>this._relayMessageToClients(s,{type:"_client-has-joined",clientInfo:e[1]},++o))),i.forEach((e=>this._relayMessageToClients(s,{type:"_client-has-left",clientUuid:e[0]},++o))),this.clients=e,this.hostClientUuid=t}));break}case"get-app-state":{let e=s.clientUuids;this.log("Get app state received -> sending app state");const t=this.kosyApp.onRequestState();this._sendMessageToKosy({type:"receive-app-state",state:t,clientUuids:e,latestMessageNumber:this.latestMessageNumber});break}case"set-app-state":this.latestMessageNumber=s.latestMessageNumber;let t=s.state;this.initialInfoPromise.then((()=>{this.log("Received app state from Kosy -> setting app state"),this.kosyApp.onProvideState(t)}));break;case"receive-message-as-host":this._handleReceiveMessageAsHost(s);break;case"receive-message-as-client":this._handleReceiveMessageAsClient(s)}})),this._sendMessageToKosy({type:"ready-and-listening"})})),this.initialInfoPromise}stopApp(){this._sendMessageToKosy({type:"stop-app"})}relayMessage(e){this.log("Relaying client message to host: ",e),this._sendMessageToKosy({type:"relay-message-to-host",message:e})}_relayMessageToClients(e,t,s){this.log("Relaying host to client message: ",t),this._sendMessageToKosy({type:"relay-message-to-clients",sentByClientUuid:e.currentClientUuid,message:t,messageNumber:s})}_sendMessageToKosy(e){this.kosyClient.postMessage(e,"*")}_handleReceiveMessageAsClientRecursive(e,t,s){var n,i,o,a,r,l;if(this.latestMessageNumber===e.messageNumber-1){switch(e.message.type){case"_host-has-changed":{let t=e.message.clientUuid;this.hostClientUuid=t,null===(i=(n=this.kosyApp).onHostHasChanged)||void 0===i||i.call(n,t);break}case"_client-has-joined":{let t=e.message.clientInfo;this.clients[t.clientUuid]=t,null===(a=(o=this.kosyApp).onClientHasJoined)||void 0===a||a.call(o,t);break}case"_client-has-left":{let t=e.message.clientUuid;this.clients[t]=null,null===(l=(r=this.kosyApp).onClientHasLeft)||void 0===l||l.call(r,t);break}default:this.kosyApp.onReceiveMessageAsClient(e.message)}this.latestMessageNumber=e.messageNumber}else s<50&&this.latestMessageNumber<e.messageNumber?setTimeout((()=>this._handleReceiveMessageAsClientRecursive(e,t,s+1)),100):(this.log("Timeout on processing message as client: ",e.message),this.log("Wait for Kosy to fix this mess..."))}_handleReceiveMessageAsClient(e){this.initialInfoPromise.then((t=>{this.log("Received message as client, processing: ",e.message),this._handleReceiveMessageAsClientRecursive(e,t,0)}))}_handleReceiveMessageAsHost(e){this.initialInfoPromise.then((t=>{this.log("Trying to handle message as host");const s=this.kosyApp.onReceiveMessageAsHost(e.message);s&&this._relayMessageToClients(t,s,this.latestMessageNumber+1)}))}log(...e){"1"===localStorage.getItem("debug-mode")&&console.log("From kosy-app-api: ",...e)}}function G(t){let s,n;return{c(){s=m("iframe"),v(s,"title","miro board"),r(s.src,n=t[0])||v(s,"src",n),v(s,"class","svelte-tbe2c")},m(e,t){h(e,s,t)},p(e,[t]){1&t&&!r(s.src,n=e[0])&&v(s,"src",n)},i:e,o:e,d(e){e&&f(s)}}}function D(e,t,s){let{url:n}=t;return e.$$set=e=>{"url"in e&&s(0,n=e.url)},[n]}const Q=class extends F{constructor(e){super(),J(this,e,D,G,o,{url:0})}};function V(e){let t,s,i,o;const a=e[5].default,r=function(e,t,s,n){if(e){const n=c(e,t,s,null);return e[0](n)}}(a,e,e[4]);return{c(){t=m("button"),r&&r.c(),v(t,"class",e[1]),t.disabled=e[0]},m(n,a){h(n,t,a),r&&r.m(t,null),s=!0,i||(o=[b(t,"click",e[6]),b(t,"dblclick",e[7]),b(t,"focus",e[8])],i=!0)},p(e,[n]){r&&r.p&&(!s||16&n)&&function(e,t,s,n,i,o){if(i){const a=c(t,s,n,o);e.p(a,i)}}(r,a,e,e[4],s?function(e,t,s,n){if(e[2]&&n){const i=e[2](n(s));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],s=Math.max(t.dirty.length,i.length);for(let n=0;n<s;n+=1)e[n]=t.dirty[n]|i[n];return e}return t.dirty|i}return t.dirty}(a,e[4],n,null):function(e){if(e.ctx.length>32){const t=[],s=e.ctx.length/32;for(let e=0;e<s;e++)t[e]=-1;return t}return-1}(e[4]),null),(!s||2&n)&&v(t,"class",e[1]),(!s||1&n)&&(t.disabled=e[0])},i(e){s||(K(r,e),s=!0)},o(e){L(r,e),s=!1},d(e){e&&f(t),r&&r.d(e),i=!1,n(o)}}}function X(e,t,s){let{$$slots:n={},$$scope:i}=t,{size:o="regular"}=t,{importance:a}=t,{disabled:r=!1}=t,l="";return e.$$set=e=>{"size"in e&&s(2,o=e.size),"importance"in e&&s(3,a=e.importance),"disabled"in e&&s(0,r=e.disabled),"$$scope"in e&&s(4,i=e.$$scope)},e.$$.update=()=>{if(12&e.$$.dirty){let e=["re-button","size-"+o];a&&e.push("importance-"+a),s(1,l=e.join(" "))}},[r,l,o,a,i,n,function(t){_.call(this,e,t)},function(t){_.call(this,e,t)},function(t){_.call(this,e,t)}]}const Y=class extends F{constructor(e){super(),J(this,e,X,V,o,{size:2,importance:3,disabled:0})}},Z=JSON.parse('{"J":{"I":"3074457356743178263","E":"https://advjhn6mca.execute-api.eu-central-1.amazonaws.com/get-miro-jwt-token"}}');function ee(e){let t;return{c(){t=g("Select a miro board")},m(e,s){h(e,t,s)},d(e){e&&f(t)}}}function te(e){let t,s,n,i,o,a,r;return a=new Y({props:{importance:"secondary",$$slots:{default:[ee]},$$scope:{ctx:e}}}),a.$on("click",e[0]),{c(){t=m("div"),s=m("div"),s.innerHTML="<h3>Embed Miro</h3>",n=$(),i=m("div"),o=$(),O(a.$$.fragment),v(s,"class","svelte-1y5yvi7"),v(i,"class","gap svelte-1y5yvi7"),v(t,"class","picking svelte-1y5yvi7")},m(e,l){h(e,t,l),p(t,s),p(t,n),p(t,i),p(t,o),q(a,t,null),r=!0},p(e,[t]){const s={};4&t&&(s.$$scope={dirty:t,ctx:e}),a.$set(s)},i(e){r||(K(a.$$.fragment,e),r=!0)},o(e){L(a.$$.fragment,e),r=!1},d(e){e&&f(t),B(a)}}}function se(e){const t=function(){const e=function(){if(!u)throw new Error("Function called outside component initialization");return u}();return(t,s)=>{const n=e.$$.callbacks[t];if(n){const i=function(e,t,s=!1){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,s,!1,t),n}(t,s);n.slice().forEach((t=>{t.call(e,i)}))}}}();return[()=>{window.miroBoardsPicker.open({clientId:Z.J.I,action:"select",allowCreateAnonymousBoards:!1,getToken:()=>fetch(Z.J.E).then((e=>e.text())),success:e=>{console.log("on success",e),t("message",{type:"miro-url-picked",payload:`https://miro.com/app/live-embed/${e.id}`})},error:e=>{console.log("on error",e)},cancel:()=>{console.log("on cancel")}})}]}const ne=class extends F{constructor(e){super(),J(this,e,se,te,o,{})}};function ie(t){let s,n,i,o,a,r,l,c,u,d,y;return{c(){s=m("div"),n=m("h3"),n.textContent="Miro sharing",i=$(),o=m("p"),a=g("Waiting for "),r=g(t[0]),l=g(" to pick a file"),c=$(),u=m("div"),d=$(),y=m("div"),y.innerHTML='<img alt="waiting" src="assets/waiting.svg"/>',v(u,"class","gap svelte-168y7ua"),v(y,"class","img-container svelte-168y7ua"),v(s,"class","waiting svelte-168y7ua")},m(e,t){h(e,s,t),p(s,n),p(s,i),p(s,o),p(o,a),p(o,r),p(o,l),p(s,c),p(s,u),p(s,d),p(s,y)},p(e,[t]){var s,n;1&t&&(s=r,n=""+(n=e[0]),s.wholeText!==n&&(s.data=n))},i:e,o:e,d(e){e&&f(s)}}}function oe(e,t,s){let{name:n}=t;return e.$$set=e=>{"name"in e&&s(0,n=e.name)},[n]}const ae=class extends F{constructor(e){super(),J(this,e,oe,ie,o,{name:0})}};function re(t){let s;return{c(){s=m("p")},m(e,t){h(e,s,t)},p:e,i:e,o:e,d(e){e&&f(s)}}}function le(e){let t,s,n,i;const o=[de,ue,ce],a=[];function r(e,t){return e[0].miroUrl?0:e[1].clientUuid===e[2].clientUuid?1:2}return t=r(e),s=a[t]=o[t](e),{c(){s.c(),n=y()},m(e,s){a[t].m(e,s),h(e,n,s),i=!0},p(e,i){let l=t;t=r(e),t===l?a[t].p(e,i):(j(),L(a[l],1,1,(()=>{a[l]=null})),z(),s=a[t],s?s.p(e,i):(s=a[t]=o[t](e),s.c()),K(s,1),s.m(n.parentNode,n))},i(e){i||(K(s),i=!0)},o(e){L(s),i=!1},d(e){a[t].d(e),e&&f(n)}}}function ce(e){let t,s;return t=new ae({props:{name:e[1].clientName}}),{c(){O(t.$$.fragment)},m(e,n){q(t,e,n),s=!0},p(e,s){const n={};2&s&&(n.name=e[1].clientName),t.$set(n)},i(e){s||(K(t.$$.fragment,e),s=!0)},o(e){L(t.$$.fragment,e),s=!1},d(e){B(t,e)}}}function ue(t){let s,n;return s=new ne({}),s.$on("message",t[4]),{c(){O(s.$$.fragment)},m(e,t){q(s,e,t),n=!0},p:e,i(e){n||(K(s.$$.fragment,e),n=!0)},o(e){L(s.$$.fragment,e),n=!1},d(e){B(s,e)}}}function de(e){let t,s;return t=new Q({props:{url:e[0].miroUrl}}),{c(){O(t.$$.fragment)},m(e,n){q(t,e,n),s=!0},p(e,s){const n={};1&s&&(n.url=e[0].miroUrl),t.$set(n)},i(e){s||(K(t.$$.fragment,e),s=!0)},o(e){L(t.$$.fragment,e),s=!1},d(e){B(t,e)}}}function pe(e){let t,s,n,i;const o=[le,re],a=[];function r(e,t){return e[1]&&e[2]?0:1}return t=r(e),s=a[t]=o[t](e),{c(){s.c(),n=y()},m(e,s){a[t].m(e,s),h(e,n,s),i=!0},p(e,[i]){let l=t;t=r(e),t===l?a[t].p(e,i):(j(),L(a[l],1,1,(()=>{a[l]=null})),z(),s=a[t],s?s.p(e,i):(s=a[t]=o[t](e),s.c()),K(s,1),s.m(n.parentNode,n))},i(e){i||(K(s),i=!0)},o(e){L(s),i=!1},d(e){a[t].d(e),e&&f(n)}}}function he(e,t,s){let n,i,o={miroUrl:null};const a=new W({onClientHasLeft:e=>(e=>{e!==n.clientUuid||o.miroUrl||a.stopApp()})(e),onReceiveMessageAsHost:e=>e,onReceiveMessageAsClient:e=>{(async e=>{"receive-miro-url"===e.type&&(console.log("Received a message from Kosy: ",e),s(0,o.miroUrl=e.payload,o))})(e)},onRequestState:()=>o,onProvideState:e=>(e=>{s(0,o=null!=e?e:o)})(e)});a.startApp().then((e=>{var t;s(1,n=e.clients[e.initializerClientUuid]),s(2,i=e.clients[e.currentClientUuid]),s(0,o=null!==(t=e.currentAppState)&&void 0!==t?t:o)}));let r=e=>{switch(e.type){case"miro-url-picked":a.relayMessage({type:"receive-miro-url",payload:e.payload});break;case"picking-canceled":a.stopApp()}};return[o,n,i,r,e=>r(e.detail)]}new class extends F{constructor(e){super(),J(this,e,he,pe,o,{})}}({target:document.getElementById("container"),props:{}})})()})();