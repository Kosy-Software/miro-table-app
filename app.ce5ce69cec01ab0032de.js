(()=>{"use strict";(()=>{function e(){}function t(e){return e()}function n(){return Object.create(null)}function s(e){e.forEach(t)}function i(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(e){return 0===Object.keys(e).length}function a(e,t,n,s){return e[1]&&s?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](s(t))):n.ctx}function c(e,t){e.appendChild(t)}function l(e,t,n){e.insertBefore(t,n||null)}function u(e){e.parentNode.removeChild(e)}function d(e){return document.createElement(e)}function p(e){return document.createTextNode(e)}function f(){return p(" ")}function m(){return p("")}function h(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}let $;function y(e){$=e}function v(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e(t)))}new Set,new Set;const b=[],k=[],w=[],M=[],_=Promise.resolve();let x=!1;function C(e){w.push(e)}let A=!1;const N=new Set;function E(){if(!A){A=!0;do{for(let e=0;e<b.length;e+=1){const t=b[e];y(t),R(t.$$)}for(y(null),b.length=0;k.length;)k.pop()();for(let e=0;e<w.length;e+=1){const t=w[e];N.has(t)||(N.add(t),t())}w.length=0}while(b.length);for(;M.length;)M.pop()();x=!1,A=!1,N.clear()}}function R(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(C)}}const T=new Set;let U,I;function P(){U={r:0,c:[],p:U}}function S(){U.r||s(U.c),U=U.p}function H(e,t){e&&e.i&&(T.delete(e),e.i(t))}function j(e,t,n,s){if(e&&e.o){if(T.has(e))return;T.add(e),U.c.push((()=>{T.delete(e),s&&(n&&e.d(1),s())})),e.o(t)}}function z(e){e&&e.c()}function K(e,n,o,r){const{fragment:a,on_mount:c,on_destroy:l,after_update:u}=e.$$;a&&a.m(n,o),r||C((()=>{const n=c.map(t).filter(i);l?l.push(...n):s(n),e.$$.on_mount=[]})),u.forEach(C)}function L(e,t){const n=e.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function O(t,i,o,r,a,c,l=[-1]){const d=$;y(t);const p=t.$$={fragment:null,ctx:null,props:c,update:e,not_equal:a,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:i.context||[]),callbacks:n(),dirty:l,skip_bound:!1};let f=!1;if(p.ctx=o?o(t,i.props||{},((e,n,...s)=>{const i=s.length?s[0]:n;return p.ctx&&a(p.ctx[e],p.ctx[e]=i)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](i),f&&function(e,t){-1===e.$$.dirty[0]&&(b.push(e),x||(x=!0,_.then(E)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],p.update(),f=!0,s(p.before_update),p.fragment=!!r&&r(p.ctx),i.target){if(i.hydrate){const e=(m=i.target,Array.from(m.childNodes));p.fragment&&p.fragment.l(e),e.forEach(u)}else p.fragment&&p.fragment.c();i.intro&&H(t.$$.fragment),K(t,i.target,i.anchor,i.customElement),E()}var m;y(d)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(I=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(t).filter(i);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){s(this.$$.on_disconnect)}$destroy(){L(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!r(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class B{$destroy(){L(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!r(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class J{constructor(e){this.kosyClient=window.parent,this.latestMessageNumber=0,this.kosyApp=e}startApp(){return this.initialInfoPromise=new Promise(((e,t)=>{window.addEventListener("message",(t=>{let n=t.data;switch(n.type){case"receive-initial-info":this.latestMessageNumber=n.latestMessageNumber,this.log("Resolving initial info promise with: ",n.payload),e(n.payload);break;case"client-has-joined":let t=n.clientInfo;this.initialInfoPromise.then((()=>{this.log("On client has joined: ",t),this.kosyApp.onClientHasJoined(t)}));break;case"client-has-left":let s=n.clientUuid;this.initialInfoPromise.then((()=>{this.log("On client has left: ",s),this.kosyApp.onClientHasLeft(s)}));break;case"get-app-state":let i=n.clientUuids;this.initialInfoPromise.then((()=>{this.log("Get app state received -> sending app state");const e=this.kosyApp.onRequestState();this._sendMessageToKosy({type:"receive-app-state",state:e,clientUuids:i,latestMessageNumber:this.latestMessageNumber})}));break;case"set-app-state":this.latestMessageNumber=n.latestMessageNumber;let o=n.state;this.initialInfoPromise.then((()=>{this.log("Received app state from Kosy -> setting app state"),this.kosyApp.onProvideState(o)}));break;case"receive-message-as-host":this._handleReceiveMessageAsHost(n);break;case"receive-message-as-client":this._handleReceiveMessageAsClient(n)}})),this._sendMessageToKosy({type:"ready-and-listening"})})),this.initialInfoPromise}stopApp(){this._sendMessageToKosy({type:"stop-app"})}relayMessage(e){this.log("Relaying client message to host: ",e),this._sendMessageToKosy({type:"relay-message-to-host",message:e})}_sendMessageToKosy(e){this.kosyClient.postMessage(e,"*")}_handleReceiveMessageAsClientRecursive(e,t,n){this.latestMessageNumber===e.messageNumber-(t.currentClientUuid===e.sentByClientUuid?0:1)?(this.kosyApp.onReceiveMessageAsClient(e.message),this.latestMessageNumber=e.messageNumber):(n<50&&this.latestMessageNumber<e.messageNumber&&setTimeout((()=>this._handleReceiveMessageAsClientRecursive(e,t,n+1)),100),this.log("Timeout on processing message as client: ",e.message),this.log("Wait for Kosy to fix this mess..."))}_handleReceiveMessageAsClient(e){this.initialInfoPromise.then((t=>{this.log("Received message as client, processing: ",e.message),this._handleReceiveMessageAsClientRecursive(e,t,0)}))}_handleReceiveMessageAsHost(e){this.initialInfoPromise.then((t=>{this.log("Trying to handle message as host");const n=this.kosyApp.onReceiveMessageAsHost(e.message);n&&(this.log("Host message was converted into client message -> notifying kosy with a relay to clients message",n),this._sendMessageToKosy({type:"relay-message-to-clients",sentByClientUuid:t.currentClientUuid,message:n,messageNumber:++this.latestMessageNumber}))}))}log(...e){"1"===localStorage.getItem("debug-mode")&&console.log("From kosy-app-api: ",...e)}}function q(t){let n,s;return{c(){n=d("iframe"),g(n,"title","miro board"),n.src!==(s=t[0])&&g(n,"src",s),g(n,"class","svelte-tbe2c")},m(e,t){l(e,n,t)},p(e,[t]){1&t&&n.src!==(s=e[0])&&g(n,"src",s)},i:e,o:e,d(e){e&&u(n)}}}function F(e,t,n){let{url:s}=t;return e.$$set=e=>{"url"in e&&n(0,s=e.url)},[s]}const W=class extends B{constructor(e){super(),O(this,e,F,q,o,{url:0})}};function G(e){let t,n,i,o;const r=e[4].default,c=function(e,t,n,s){if(e){const s=a(e,t,n,null);return e[0](s)}}(r,e,e[3]);return{c(){t=d("button"),c&&c.c(),g(t,"class",e[0])},m(s,r){l(s,t,r),c&&c.m(t,null),n=!0,i||(o=[h(t,"click",e[5]),h(t,"dblclick",e[6]),h(t,"focus",e[7])],i=!0)},p(e,[s]){c&&c.p&&(!n||8&s)&&function(e,t,n,s,i,o,r){const c=function(e,t,n,s){if(e[2]&&s){const i=e[2](s(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|i[s];return e}return t.dirty|i}return t.dirty}(t,s,i,null);if(c){const i=a(t,n,s,null);e.p(i,c)}}(c,r,e,e[3],s),(!n||1&s)&&g(t,"class",e[0])},i(e){n||(H(c,e),n=!0)},o(e){j(c,e),n=!1},d(e){e&&u(t),c&&c.d(e),i=!1,s(o)}}}function D(e,t,n){let{$$slots:s={},$$scope:i}=t,{size:o}=t,{importance:r}=t,a="";return e.$$set=e=>{"size"in e&&n(1,o=e.size),"importance"in e&&n(2,r=e.importance),"$$scope"in e&&n(3,i=e.$$scope)},e.$$.update=()=>{if(6&e.$$.dirty){let e=[];o?e.push("size-"+o):e.push("size-regular"),r&&e.push("importance-"+r),n(0,a=["re-button",...e].join(" "))}},[a,o,r,i,s,function(t){v(e,t)},function(t){v(e,t)},function(t){v(e,t)}]}const Q=class extends B{constructor(e){super(),O(this,e,D,G,o,{size:1,importance:2})}},V=JSON.parse('{"J":{"I":"3074457356743178263","E":"https://advjhn6mca.execute-api.eu-central-1.amazonaws.com/get-miro-jwt-token"}}');function X(e){let t;return{c(){t=p("Select a miro board")},m(e,n){l(e,t,n)},d(e){e&&u(t)}}}function Y(e){let t,n,s,i,o,r,a;return r=new Q({props:{importance:"secondary",$$slots:{default:[X]},$$scope:{ctx:e}}}),r.$on("click",e[0]),{c(){t=d("div"),n=d("div"),n.innerHTML="<h3>Embed Miro</h3>",s=f(),i=d("div"),o=f(),z(r.$$.fragment),g(n,"class","svelte-1y5yvi7"),g(i,"class","gap svelte-1y5yvi7"),g(t,"class","picking svelte-1y5yvi7")},m(e,u){l(e,t,u),c(t,n),c(t,s),c(t,i),c(t,o),K(r,t,null),a=!0},p(e,[t]){const n={};4&t&&(n.$$scope={dirty:t,ctx:e}),r.$set(n)},i(e){a||(H(r.$$.fragment,e),a=!0)},o(e){j(r.$$.fragment,e),a=!1},d(e){e&&u(t),L(r)}}}function Z(e){const t=function(){const e=function(){if(!$)throw new Error("Function called outside component initialization");return $}();return(t,n)=>{const s=e.$$.callbacks[t];if(s){const i=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);s.slice().forEach((t=>{t.call(e,i)}))}}}();return[()=>{window.miroBoardsPicker.open({clientId:V.J.I,action:"select",allowCreateAnonymousBoards:!1,getToken:()=>fetch(V.J.E).then((e=>e.text())),success:e=>{console.log("on success",e),t("message",{type:"miro-url-picked",payload:`https://miro.com/app/live-embed/${e.id}`})},error:e=>{console.log("on error",e)},cancel:()=>{console.log("on cancel")}})}]}const ee=class extends B{constructor(e){super(),O(this,e,Z,Y,o,{})}};function te(t){let n,s,i,o,r,a,m,h,$,y,v;return{c(){n=d("div"),s=d("h3"),s.textContent="Miro sharing",i=f(),o=d("p"),r=p("Waiting for "),a=p(t[0]),m=p(" to pick a file"),h=f(),$=d("div"),y=f(),v=d("div"),v.innerHTML='<img alt="waiting" src="assets/waiting.svg"/>',g($,"class","gap svelte-168y7ua"),g(v,"class","img-container svelte-168y7ua"),g(n,"class","waiting svelte-168y7ua")},m(e,t){l(e,n,t),c(n,s),c(n,i),c(n,o),c(o,r),c(o,a),c(o,m),c(n,h),c(n,$),c(n,y),c(n,v)},p(e,[t]){var n,s;1&t&&(n=a,s=""+(s=e[0]),n.wholeText!==s&&(n.data=s))},i:e,o:e,d(e){e&&u(n)}}}function ne(e,t,n){let{name:s}=t;return e.$$set=e=>{"name"in e&&n(0,s=e.name)},[s]}const se=class extends B{constructor(e){super(),O(this,e,ne,te,o,{name:0})}};function ie(t){let n;return{c(){n=d("p")},m(e,t){l(e,n,t)},p:e,i:e,o:e,d(e){e&&u(n)}}}function oe(e){let t,n,s,i;const o=[ce,ae,re],r=[];function a(e,t){return e[0].miroUrl?0:e[1].clientUuid===e[2].clientUuid?1:2}return t=a(e),n=r[t]=o[t](e),{c(){n.c(),s=m()},m(e,n){r[t].m(e,n),l(e,s,n),i=!0},p(e,i){let c=t;t=a(e),t===c?r[t].p(e,i):(P(),j(r[c],1,1,(()=>{r[c]=null})),S(),n=r[t],n?n.p(e,i):(n=r[t]=o[t](e),n.c()),H(n,1),n.m(s.parentNode,s))},i(e){i||(H(n),i=!0)},o(e){j(n),i=!1},d(e){r[t].d(e),e&&u(s)}}}function re(e){let t,n;return t=new se({props:{name:e[1].clientName}}),{c(){z(t.$$.fragment)},m(e,s){K(t,e,s),n=!0},p(e,n){const s={};2&n&&(s.name=e[1].clientName),t.$set(s)},i(e){n||(H(t.$$.fragment,e),n=!0)},o(e){j(t.$$.fragment,e),n=!1},d(e){L(t,e)}}}function ae(t){let n,s;return n=new ee({}),n.$on("message",t[4]),{c(){z(n.$$.fragment)},m(e,t){K(n,e,t),s=!0},p:e,i(e){s||(H(n.$$.fragment,e),s=!0)},o(e){j(n.$$.fragment,e),s=!1},d(e){L(n,e)}}}function ce(e){let t,n;return t=new W({props:{url:e[0].miroUrl}}),{c(){z(t.$$.fragment)},m(e,s){K(t,e,s),n=!0},p(e,n){const s={};1&n&&(s.url=e[0].miroUrl),t.$set(s)},i(e){n||(H(t.$$.fragment,e),n=!0)},o(e){j(t.$$.fragment,e),n=!1},d(e){L(t,e)}}}function le(e){let t,n,s,i;const o=[oe,ie],r=[];function a(e,t){return e[1]&&e[2]?0:1}return t=a(e),n=r[t]=o[t](e),{c(){n.c(),s=m()},m(e,n){r[t].m(e,n),l(e,s,n),i=!0},p(e,[i]){let c=t;t=a(e),t===c?r[t].p(e,i):(P(),j(r[c],1,1,(()=>{r[c]=null})),S(),n=r[t],n?n.p(e,i):(n=r[t]=o[t](e),n.c()),H(n,1),n.m(s.parentNode,s))},i(e){i||(H(n),i=!0)},o(e){j(n),i=!1},d(e){r[t].d(e),e&&u(s)}}}function ue(e,t,n){var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function r(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((s=s.apply(e,t||[])).next())}))};let i,o,r={miroUrl:null};const a=new J({onClientHasJoined:e=>{},onClientHasLeft:e=>(e=>{e!==i.clientUuid||r.miroUrl||a.stopApp()})(e),onReceiveMessageAsHost:e=>e,onReceiveMessageAsClient:e=>{(e=>{s(void 0,void 0,void 0,(function*(){switch(e.type){case"receive-miro-url":console.log("Received a message from Kosy: ",e),n(0,r.miroUrl=e.payload,r)}}))})(e)},onRequestState:()=>r,onProvideState:e=>(e=>{n(0,r=null!=e?e:r)})(e)});a.startApp().then((e=>{var t;n(1,i=e.clients[e.initializerClientUuid]),n(2,o=e.clients[e.currentClientUuid]),n(0,r=null!==(t=e.currentAppState)&&void 0!==t?t:r)}));let c=e=>{switch(e.type){case"miro-url-picked":a.relayMessage({type:"receive-miro-url",payload:e.payload});break;case"picking-canceled":a.stopApp()}};return[r,i,o,c,e=>c(e.detail)]}new class extends B{constructor(e){super(),O(this,e,ue,le,o,{})}}({target:document.getElementById("container"),props:{}})})()})();