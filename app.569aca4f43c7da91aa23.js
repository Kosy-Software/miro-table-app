(()=>{"use strict";(()=>{function e(){}function t(e){return e()}function n(){return Object.create(null)}function s(e){e.forEach(t)}function i(e){return"function"==typeof e}function o(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e){return 0===Object.keys(e).length}function c(e,t,n,s){return e[1]&&s?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](s(t))):n.ctx}function r(e,t){e.appendChild(t)}function l(e,t,n){e.insertBefore(t,n||null)}function u(e){e.parentNode.removeChild(e)}function d(e){return document.createElement(e)}function p(e){return document.createTextNode(e)}function h(){return p(" ")}function f(){return p("")}function m(e,t,n,s){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n,s)}function g(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}let y;function $(e){y=e}function v(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach((e=>e(t)))}new Set,new Set;const b=[],k=[],_=[],w=[],M=Promise.resolve();let C=!1;function A(e){_.push(e)}let x=!1;const T=new Set;function N(){if(!x){x=!0;do{for(let e=0;e<b.length;e+=1){const t=b[e];$(t),U(t.$$)}for($(null),b.length=0;k.length;)k.pop()();for(let e=0;e<_.length;e+=1){const t=_[e];T.has(t)||(T.add(t),t())}_.length=0}while(b.length);for(;w.length;)w.pop()();C=!1,x=!1,T.clear()}}function U(e){if(null!==e.fragment){e.update(),s(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(A)}}const E=new Set;let R,H;function S(){R={r:0,c:[],p:R}}function I(){R.r||s(R.c),R=R.p}function P(e,t){e&&e.i&&(E.delete(e),e.i(t))}function j(e,t,n,s){if(e&&e.o){if(E.has(e))return;E.add(e),R.c.push((()=>{E.delete(e),s&&(n&&e.d(1),s())})),e.o(t)}}function z(e){e&&e.c()}function L(e,n,o,a){const{fragment:c,on_mount:r,on_destroy:l,after_update:u}=e.$$;c&&c.m(n,o),a||A((()=>{const n=r.map(t).filter(i);l?l.push(...n):s(n),e.$$.on_mount=[]})),u.forEach(A)}function K(e,t){const n=e.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function O(t,i,o,a,c,r,l=[-1]){const d=y;$(t);const p=t.$$={fragment:null,ctx:null,props:r,update:e,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(d?d.$$.context:i.context||[]),callbacks:n(),dirty:l,skip_bound:!1};let h=!1;if(p.ctx=o?o(t,i.props||{},((e,n,...s)=>{const i=s.length?s[0]:n;return p.ctx&&c(p.ctx[e],p.ctx[e]=i)&&(!p.skip_bound&&p.bound[e]&&p.bound[e](i),h&&function(e,t){-1===e.$$.dirty[0]&&(b.push(e),C||(C=!0,M.then(N)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(t,e)),n})):[],p.update(),h=!0,s(p.before_update),p.fragment=!!a&&a(p.ctx),i.target){if(i.hydrate){const e=(f=i.target,Array.from(f.childNodes));p.fragment&&p.fragment.l(e),e.forEach(u)}else p.fragment&&p.fragment.c();i.intro&&P(t.$$.fragment),L(t,i.target,i.anchor,i.customElement),N()}var f;$(d)}"undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global,new Set(["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"]),"function"==typeof HTMLElement&&(H=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(t).filter(i);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,n){this[e]=n}disconnectedCallback(){s(this.$$.on_disconnect)}$destroy(){K(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!a(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});class J{$destroy(){K(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){this.$$set&&!a(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}class q{constructor(e){this.kosyClient=window.parent,this.latestMessageNumber=0,this.kosyApp=e}dictionaryToArray(e){let t=[];for(const n in e)e.hasOwnProperty(n)&&t.push([n,e[n]]);return t}startApp(){return this.initialInfoPromise=new Promise(((e,t)=>{window.addEventListener("message",(t=>{let n=t.data;switch(n.type){case"receive-initial-info":this.latestMessageNumber=n.latestMessageNumber,this.clients=n.payload.clients,this.hostClientUuid=n.payload.initializerClientUuid,this.log("Resolving initial info promise with: ",n.payload),e(n.payload);break;case"set-client-info":{let e=n.clients,t=n.hostClientUuid;this.initialInfoPromise.then((s=>{let i=this.dictionaryToArray(e).filter((e=>!this.clients[e[0]])),o=this.dictionaryToArray(this.clients).filter((t=>!e[t[0]])),a=this.latestMessageNumber;t!==this.hostClientUuid&&"function"==typeof this.kosyApp.onHostHasChanged&&(this.log("On host has changed was defined -> notifying everyone the host has changed",n),this._relayMessageToClients(s,{type:"_host-has-changed",clientUuid:t},++a)),i.length>0&&"function"==typeof this.kosyApp.onClientHasJoined&&(this.log("On client has joined was defined",n),i.forEach((e=>this._relayMessageToClients(s,{type:"_client-has-joined",clientInfo:e[1]},++a)))),o.length>0&&"function"==typeof this.kosyApp.onClientHasLeft&&(this.log("On client has left was defined",n),o.forEach((e=>this._relayMessageToClients(s,{type:"_client-has-left",clientUuid:e[0]},++a)))),this.clients=e,this.hostClientUuid=t}));break}case"get-app-state":{let e=n.clientUuids;this.log("Get app state received -> sending app state");const t=this.kosyApp.onRequestState();this._sendMessageToKosy({type:"receive-app-state",state:t,clientUuids:e,latestMessageNumber:this.latestMessageNumber});break}case"set-app-state":this.latestMessageNumber=n.latestMessageNumber;let t=n.state;this.initialInfoPromise.then((()=>{this.log("Received app state from Kosy -> setting app state"),this.kosyApp.onProvideState(t)}));break;case"receive-message-as-host":this._handleReceiveMessageAsHost(n);break;case"receive-message-as-client":this._handleReceiveMessageAsClient(n)}})),this._sendMessageToKosy({type:"ready-and-listening"})})),this.initialInfoPromise}stopApp(){this._sendMessageToKosy({type:"stop-app"})}relayMessage(e){this.log("Relaying client message to host: ",e),this._sendMessageToKosy({type:"relay-message-to-host",message:e})}_relayMessageToClients(e,t,n){this.log("Relaying host to client message: ",t),this._sendMessageToKosy({type:"relay-message-to-clients",sentByClientUuid:e.currentClientUuid,message:t,messageNumber:n})}_sendMessageToKosy(e){this.kosyClient.postMessage(e,"*")}_handleReceiveMessageAsClientRecursive(e,t,n){var s,i,o,a,c,r;if(this.latestMessageNumber===e.messageNumber-1){switch(e.message.type){case"_host-has-changed":null===(i=(s=this.kosyApp).onHostHasChanged)||void 0===i||i.call(s,e.message.clientUuid);break;case"_client-has-joined":null===(a=(o=this.kosyApp).onClientHasJoined)||void 0===a||a.call(o,e.message.clientInfo);break;case"_client-has-left":null===(r=(c=this.kosyApp).onClientHasLeft)||void 0===r||r.call(c,e.message.clientUuid);break;default:this.kosyApp.onReceiveMessageAsClient(e.message)}this.latestMessageNumber=e.messageNumber}else n<50&&this.latestMessageNumber<e.messageNumber?setTimeout((()=>this._handleReceiveMessageAsClientRecursive(e,t,n+1)),100):(this.log("Timeout on processing message as client: ",e.message),this.log("Wait for Kosy to fix this mess..."))}_handleReceiveMessageAsClient(e){this.initialInfoPromise.then((t=>{this.log("Received message as client, processing: ",e.message),this._handleReceiveMessageAsClientRecursive(e,t,0)}))}_handleReceiveMessageAsHost(e){this.initialInfoPromise.then((t=>{this.log("Trying to handle message as host");const n=this.kosyApp.onReceiveMessageAsHost(e.message);n&&this._relayMessageToClients(t,n,this.latestMessageNumber+1)}))}log(...e){"1"===localStorage.getItem("debug-mode")&&console.log("From kosy-app-api: ",...e)}}function B(t){let n,s;return{c(){n=d("iframe"),g(n,"title","miro board"),n.src!==(s=t[0])&&g(n,"src",s),g(n,"class","svelte-tbe2c")},m(e,t){l(e,n,t)},p(e,[t]){1&t&&n.src!==(s=e[0])&&g(n,"src",s)},i:e,o:e,d(e){e&&u(n)}}}function F(e,t,n){let{url:s}=t;return e.$$set=e=>{"url"in e&&n(0,s=e.url)},[s]}const W=class extends J{constructor(e){super(),O(this,e,F,B,o,{url:0})}};function G(e){let t,n,i,o;const a=e[4].default,r=function(e,t,n,s){if(e){const s=c(e,t,n,null);return e[0](s)}}(a,e,e[3]);return{c(){t=d("button"),r&&r.c(),g(t,"class",e[0])},m(s,a){l(s,t,a),r&&r.m(t,null),n=!0,i||(o=[m(t,"click",e[5]),m(t,"dblclick",e[6]),m(t,"focus",e[7])],i=!0)},p(e,[s]){r&&r.p&&(!n||8&s)&&function(e,t,n,s,i,o,a){const r=function(e,t,n,s){if(e[2]&&s){const i=e[2](s(n));if(void 0===t.dirty)return i;if("object"==typeof i){const e=[],n=Math.max(t.dirty.length,i.length);for(let s=0;s<n;s+=1)e[s]=t.dirty[s]|i[s];return e}return t.dirty|i}return t.dirty}(t,s,i,null);if(r){const i=c(t,n,s,null);e.p(i,r)}}(r,a,e,e[3],s),(!n||1&s)&&g(t,"class",e[0])},i(e){n||(P(r,e),n=!0)},o(e){j(r,e),n=!1},d(e){e&&u(t),r&&r.d(e),i=!1,s(o)}}}function D(e,t,n){let{$$slots:s={},$$scope:i}=t,{size:o}=t,{importance:a}=t,c="";return e.$$set=e=>{"size"in e&&n(1,o=e.size),"importance"in e&&n(2,a=e.importance),"$$scope"in e&&n(3,i=e.$$scope)},e.$$.update=()=>{if(6&e.$$.dirty){let e=[];o?e.push("size-"+o):e.push("size-regular"),a&&e.push("importance-"+a),n(0,c=["re-button",...e].join(" "))}},[c,o,a,i,s,function(t){v(e,t)},function(t){v(e,t)},function(t){v(e,t)}]}const Q=class extends J{constructor(e){super(),O(this,e,D,G,o,{size:1,importance:2})}},V=JSON.parse('{"J":{"I":"3074457356743178263","E":"https://advjhn6mca.execute-api.eu-central-1.amazonaws.com/get-miro-jwt-token"}}');function X(e){let t;return{c(){t=p("Select a miro board")},m(e,n){l(e,t,n)},d(e){e&&u(t)}}}function Y(e){let t,n,s,i,o,a,c;return a=new Q({props:{importance:"secondary",$$slots:{default:[X]},$$scope:{ctx:e}}}),a.$on("click",e[0]),{c(){t=d("div"),n=d("div"),n.innerHTML="<h3>Embed Miro</h3>",s=h(),i=d("div"),o=h(),z(a.$$.fragment),g(n,"class","svelte-1y5yvi7"),g(i,"class","gap svelte-1y5yvi7"),g(t,"class","picking svelte-1y5yvi7")},m(e,u){l(e,t,u),r(t,n),r(t,s),r(t,i),r(t,o),L(a,t,null),c=!0},p(e,[t]){const n={};4&t&&(n.$$scope={dirty:t,ctx:e}),a.$set(n)},i(e){c||(P(a.$$.fragment,e),c=!0)},o(e){j(a.$$.fragment,e),c=!1},d(e){e&&u(t),K(a)}}}function Z(e){const t=function(){const e=function(){if(!y)throw new Error("Function called outside component initialization");return y}();return(t,n)=>{const s=e.$$.callbacks[t];if(s){const i=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);s.slice().forEach((t=>{t.call(e,i)}))}}}();return[()=>{window.miroBoardsPicker.open({clientId:V.J.I,action:"select",allowCreateAnonymousBoards:!1,getToken:()=>fetch(V.J.E).then((e=>e.text())),success:e=>{console.log("on success",e),t("message",{type:"miro-url-picked",payload:`https://miro.com/app/live-embed/${e.id}`})},error:e=>{console.log("on error",e)},cancel:()=>{console.log("on cancel")}})}]}const ee=class extends J{constructor(e){super(),O(this,e,Z,Y,o,{})}};function te(t){let n,s,i,o,a,c,f,m,y,$,v;return{c(){n=d("div"),s=d("h3"),s.textContent="Miro sharing",i=h(),o=d("p"),a=p("Waiting for "),c=p(t[0]),f=p(" to pick a file"),m=h(),y=d("div"),$=h(),v=d("div"),v.innerHTML='<img alt="waiting" src="assets/waiting.svg"/>',g(y,"class","gap svelte-168y7ua"),g(v,"class","img-container svelte-168y7ua"),g(n,"class","waiting svelte-168y7ua")},m(e,t){l(e,n,t),r(n,s),r(n,i),r(n,o),r(o,a),r(o,c),r(o,f),r(n,m),r(n,y),r(n,$),r(n,v)},p(e,[t]){var n,s;1&t&&(n=c,s=""+(s=e[0]),n.wholeText!==s&&(n.data=s))},i:e,o:e,d(e){e&&u(n)}}}function ne(e,t,n){let{name:s}=t;return e.$$set=e=>{"name"in e&&n(0,s=e.name)},[s]}const se=class extends J{constructor(e){super(),O(this,e,ne,te,o,{name:0})}};function ie(t){let n;return{c(){n=d("p")},m(e,t){l(e,n,t)},p:e,i:e,o:e,d(e){e&&u(n)}}}function oe(e){let t,n,s,i;const o=[re,ce,ae],a=[];function c(e,t){return e[0].miroUrl?0:e[1].clientUuid===e[2].clientUuid?1:2}return t=c(e),n=a[t]=o[t](e),{c(){n.c(),s=f()},m(e,n){a[t].m(e,n),l(e,s,n),i=!0},p(e,i){let r=t;t=c(e),t===r?a[t].p(e,i):(S(),j(a[r],1,1,(()=>{a[r]=null})),I(),n=a[t],n?n.p(e,i):(n=a[t]=o[t](e),n.c()),P(n,1),n.m(s.parentNode,s))},i(e){i||(P(n),i=!0)},o(e){j(n),i=!1},d(e){a[t].d(e),e&&u(s)}}}function ae(e){let t,n;return t=new se({props:{name:e[1].clientName}}),{c(){z(t.$$.fragment)},m(e,s){L(t,e,s),n=!0},p(e,n){const s={};2&n&&(s.name=e[1].clientName),t.$set(s)},i(e){n||(P(t.$$.fragment,e),n=!0)},o(e){j(t.$$.fragment,e),n=!1},d(e){K(t,e)}}}function ce(t){let n,s;return n=new ee({}),n.$on("message",t[4]),{c(){z(n.$$.fragment)},m(e,t){L(n,e,t),s=!0},p:e,i(e){s||(P(n.$$.fragment,e),s=!0)},o(e){j(n.$$.fragment,e),s=!1},d(e){K(n,e)}}}function re(e){let t,n;return t=new W({props:{url:e[0].miroUrl}}),{c(){z(t.$$.fragment)},m(e,s){L(t,e,s),n=!0},p(e,n){const s={};1&n&&(s.url=e[0].miroUrl),t.$set(s)},i(e){n||(P(t.$$.fragment,e),n=!0)},o(e){j(t.$$.fragment,e),n=!1},d(e){K(t,e)}}}function le(e){let t,n,s,i;const o=[oe,ie],a=[];function c(e,t){return e[1]&&e[2]?0:1}return t=c(e),n=a[t]=o[t](e),{c(){n.c(),s=f()},m(e,n){a[t].m(e,n),l(e,s,n),i=!0},p(e,[i]){let r=t;t=c(e),t===r?a[t].p(e,i):(S(),j(a[r],1,1,(()=>{a[r]=null})),I(),n=a[t],n?n.p(e,i):(n=a[t]=o[t](e),n.c()),P(n,1),n.m(s.parentNode,s))},i(e){i||(P(n),i=!0)},o(e){j(n),i=!1},d(e){a[t].d(e),e&&u(s)}}}function ue(e,t,n){var s=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(i,o){function a(e){try{r(s.next(e))}catch(e){o(e)}}function c(e){try{r(s.throw(e))}catch(e){o(e)}}function r(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,c)}r((s=s.apply(e,t||[])).next())}))};let i,o,a={miroUrl:null};const c=new q({onClientHasLeft:e=>(e=>{e!==i.clientUuid||a.miroUrl||c.stopApp()})(e),onReceiveMessageAsHost:e=>e,onReceiveMessageAsClient:e=>{(e=>{s(void 0,void 0,void 0,(function*(){switch(e.type){case"receive-miro-url":console.log("Received a message from Kosy: ",e),n(0,a.miroUrl=e.payload,a)}}))})(e)},onRequestState:()=>a,onProvideState:e=>(e=>{n(0,a=null!=e?e:a)})(e)});c.startApp().then((e=>{var t;n(1,i=e.clients[e.initializerClientUuid]),n(2,o=e.clients[e.currentClientUuid]),n(0,a=null!==(t=e.currentAppState)&&void 0!==t?t:a)}));let r=e=>{switch(e.type){case"miro-url-picked":c.relayMessage({type:"receive-miro-url",payload:e.payload});break;case"picking-canceled":c.stopApp()}};return[a,i,o,r,e=>r(e.detail)]}new class extends J{constructor(e){super(),O(this,e,ue,le,o,{})}}({target:document.getElementById("container"),props:{}})})()})();